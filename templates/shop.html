{% load static tailwind_tags %} {% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Shop - StyleOdds</title>

    <!-- Tailwind CSS -->
    {% tailwind_css %}
    <!-- In <head> or just before </body> -->
<script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

  </head>

  <body class="bg-gray-100 text-gray-900 font-sans">

<!-- Header -->
<header class="bg-white shadow sticky top-0 z-50">
  <div class="container mx-auto px-6 py-4 flex justify-between items-center">
    <div class="text-2xl font-bold text-black"><a href="{% url 'home' %}">StyleOdds</a></div>

    <!-- Desktop Menu -->
    <nav class="hidden md:flex space-x-8 text-gray-700 font-medium">
     
      <a href="{% url 'home' %}" class="hover:text-black transition">Home</a>
      <a href="{% url 'shop' %}" class="hover:text-black transition">Shop</a>
      <a href="{% url 'vintage_archive' %}" class="hover:text-black transition">Vintage Archive</a>
      <a href="{% url 'style_boards' %}" class="hover:text-black transition">Style Boards</a>
      <a href="{% url 'cart' %}" class="hover:text-black transition">Cart (<span id="cart-count">0</span>)</a>
      
      {% if user.is_authenticated %}
      <div x-data="{ open: false }" class="relative">
          <button @click="open = !open" class="rounded-full bg-gray-200 p-2 focus:outline-none">
              ðŸ‘¤
          </button>
          <div x-show="open" @click.away="open = false" class="absolute right-0 mt-2 w-32 bg-white border rounded shadow-md py-2">
              <a href="{% url 'profile' %}" class="block px-4 py-2 text-gray-800 hover:bg-gray-100">Profile</a>
              <a href="{% url 'logout' %}" class="block px-4 py-2 text-gray-800 hover:bg-gray-100">Logout</a>
          </div>
      </div>
  {% else %}
      <a href="{% url 'login' %}" class="text-gray-800 hover:text-gray-600 mx-2">Login</a>
      <a href="{% url 'signup' %}" class="text-gray-800 hover:text-gray-600 mx-2">Signup</a>
  {% endif %}

    </nav>

    <!-- Mobile Hamburger -->
    <div class="md:hidden">
      <button id="menu-btn" class="focus:outline-none">
        <svg class="w-8 h-8 text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
            d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div id="menu" class="hidden md:hidden bg-white">
    <nav class="flex flex-col items-center py-4 space-y-4">
      <a href="#" class="hover:text-black">Home</a>
      <a href="#" class="hover:text-black">Shop</a>
      <a href="#" class="hover:text-black">Vintage Archive</a>
      <a href="#" class="hover:text-black">Style Boards</a>
      <a href="#" class="hover:text-black">Login</a>
    </nav>
  </div>
</header>

    

    <!-- Filters -->
    <section class="container mx-auto px-6 py-6">
      <div class="flex flex-wrap gap-4 justify-center">
        <button
          onclick="filterProducts('all')"
          class="px-5 py-2 rounded-full bg-black text-white hover:bg-gray-800 transition"
        >
          All
        </button>
        <button
          onclick="filterProducts('mens-shirts')"
          class="px-5 py-2 rounded-full bg-black text-white hover:bg-gray-800 transition"
        >
          Men's Shirts
        </button>
        <button
          onclick="filterProducts('womens-dresses')"
          class="px-5 py-2 rounded-full bg-black text-white hover:bg-gray-800 transition"
        >
          Women's Dresses
        </button>
        <button
          onclick="filterProducts('womens-shoes')"
          class="px-5 py-2 rounded-full bg-black text-white hover:bg-gray-800 transition"
        >
          Women's Shoes
        </button>
        <button
          onclick="filterProducts('tops')"
          class="px-5 py-2 rounded-full bg-black text-white hover:bg-gray-800 transition"
        >
          Tops
        </button>
        <button
          onclick="filterProducts('mens-shoes')"
          class="px-5 py-2 rounded-full bg-black text-white hover:bg-gray-800 transition"
        >
          Men's Shoes
        </button>
        <button
          onclick="filterProducts('womens-bags')"
          class="px-5 py-2 rounded-full bg-black text-white hover:bg-gray-800 transition"
        >
          Women's Bags
        </button>
      </div>
    </section>

    <!-- Products -->
    <section class="container mx-auto px-6 py-6">
      <div
        id="products"
        class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-8"
      >
        <!-- Products load here -->
      </div>

      <!-- Pagination -->
      <div class="flex justify-center items-center space-x-6 mt-8">
        <button
          id="prevPage"
          onclick="previousPage()"
          class="px-4 py-2 bg-gray-700 text-white rounded hover:bg-gray-900 transition disabled:opacity-50"
          disabled
        >
          Previous
        </button>
        <span id="currentPage" class="text-gray-700 font-semibold">Page 1</span>
        <button
          id="nextPage"
          onclick="nextPage()"
          class="px-4 py-2 bg-gray-700 text-white rounded hover:bg-gray-900 transition"
        >
          Next
        </button>
      </div>

      <!-- Loader -->
      <div id="loader" class="text-center my-6 hidden">
        <span class="text-gray-600">Loading more products...</span>
      </div>
    </section>

    <!-- Scripts -->
    <script>
      const productsContainer = document.getElementById("products");
      const loader = document.getElementById("loader");
      const currentPageElement = document.getElementById("currentPage");
      const prevPageBtn = document.getElementById("prevPage");
      const nextPageBtn = document.getElementById("nextPage");
      const cartCount = document.getElementById("cart-count");

      let page = 1;
      let currentCategory = "all";
      const limit = 8;
      const fashionCategories = [
        "mens-shirts",
        "womens-dresses",
        "womens-shoes",
        "tops",
        "sunglasses",
        "womens-bags",
        "mens-shoes",
      ];

      async function loadProducts(reset = false) {
        loader.classList.remove("hidden");
        if (reset) {
          productsContainer.innerHTML = "";
        }

        let products = [];

        if (currentCategory === "all") {
          for (const category of fashionCategories) {
            const res = await fetch(
              `https://dummyjson.com/products/category/${category}?limit=3&skip=${
                (page - 1) * limit
              }`
            );
            const data = await res.json();
            products = products.concat(data.products);
          }
        } else {
          const res = await fetch(
            `https://dummyjson.com/products/category/${currentCategory}?limit=${limit}&skip=${
              (page - 1) * limit
            }`
          );
          const data = await res.json();
          products = data.products || [];
        }

        loader.classList.add("hidden");

        productsContainer.innerHTML = "";

        products.forEach((product) => {
          const priceInINR = Math.round(product.price * 83.5);
          const productCard = `
    <div class="bg-white p-4 rounded-lg shadow-md hover:shadow-lg transition cursor-pointer flex flex-col">
      <img src="${product.thumbnail}" alt="${product.title}" class="h-64 w-full object-cover rounded">
      <div class="mt-4 flex-1">
        <h3 class="text-lg font-semibold">${product.title}</h3>
        <p class="text-gray-600 mt-1">â‚¹${priceInINR}</p>
      </div>
      <div class="mt-4 flex flex-col gap-2">
        <button onclick="viewDetails(${product.id})" class="text-sm font-medium text-white bg-black hover:bg-gray-800 px-4 py-2 rounded-full transition">View Details</button>
        <button onclick="addToCart(${product.id}, '${product.title}', ${priceInINR}, '${product.thumbnail}')" class="text-sm font-medium text-black bg-white border border-gray-400 hover:bg-gray-100 px-4 py-2 rounded-full transition">Add to Cart</button>
      </div>
    </div>
  `;
          productsContainer.insertAdjacentHTML("beforeend", productCard);
        });

        currentPageElement.textContent = `Page ${page}`;
        prevPageBtn.disabled = page === 1;
      }

      function nextPage() {
        page++;
        loadProducts();
      }

      function previousPage() {
        if (page > 1) {
          page--;
          loadProducts();
        }
      }

      function filterProducts(category) {
        currentCategory = category;
        page = 1;
        loadProducts(true);
      }

      function viewDetails(id) {
        localStorage.setItem("productId", id);
        window.location.href = "{% url 'view_details' %}";
      }

      function addToCart(id, title, price, image) {
        let cart = JSON.parse(localStorage.getItem("cart")) || [];
        const existingProduct = cart.find((item) => item.id === id);
        if (existingProduct) {
          existingProduct.quantity += 1;
        } else {
          cart.push({ id, title, price, image, quantity: 1 });
        }
        localStorage.setItem("cart", JSON.stringify(cart));
        updateCartCount();
        alert("Item added to cart!");
      }

      function updateCartCount() {
        let cart = JSON.parse(localStorage.getItem("cart")) || [];
        cartCount.textContent = cart.reduce(
          (sum, item) => sum + item.quantity,
          0
        );
      }

      updateCartCount();
      loadProducts();
    </script>
  </body>
</html>
